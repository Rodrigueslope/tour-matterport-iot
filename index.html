
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Tour Matterport + API P√∫blica (Evolu√≠do)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        #overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            padding: 15px;
            font-size: 16px;
            border-radius: 10px;
            z-index: 999;
            min-width: 220px;
        }
        #chart-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 300px;
            height: 200px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div id="container">
        <iframe id="showcase" 
            src="https://my.matterport.com/show/?m=SEUCODIGOTOUR&play=1&applicationKey=SUA-API-KEY" 
            allow="fullscreen; vr; accelerometer; gyroscope; magnetometer; xr-spatial-tracking;">
        </iframe>

        <div id="overlay">
            <div>üå°Ô∏è Temp Atual: <span id="tempAtual">--</span> ¬∞C</div>
            <div>üíß Umidade: <span id="umidadeAtual">--</span> %</div>
        </div>

        <div id="chart-container">
            <canvas id="tempChart"></canvas>
        </div>
    </div>

    <script>
        const showcase = document.getElementById('showcase');
        const tempSpan = document.getElementById('tempAtual');
        const umidadeSpan = document.getElementById('umidadeAtual');
        const overlay = document.getElementById('overlay');

        const tempChartCtx = document.getElementById('tempChart').getContext('2d');
        const tempChart = new Chart(tempChartCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Temperatura (¬∞C)',
                    data: [],
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 2,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: false
                    }
                }
            }
        });

        window.addEventListener('message', function(event) {
            if (event.data.type === 'showcaseReady') {
                console.log('Tour carregado!');
                atualizarDados();
                setInterval(atualizarDados, 300000); // Atualiza a cada 5 minutos
            }
        });

        function atualizarDados() {
            fetch('https://api.open-meteo.com/v1/forecast?latitude=-23.55&longitude=-46.63&current_weather=true')
                .then(response => response.json())
                .then(data => {
                    const tempAtual = data.current_weather.temperature;
                    const umidadeAtual = data.current_weather.relativehumidity ?? 60; // Valor fict√≠cio para testes

                    tempSpan.textContent = tempAtual;
                    umidadeSpan.textContent = umidadeAtual;

                    // Atualiza gr√°fico
                    const agora = new Date().toLocaleTimeString();
                    tempChart.data.labels.push(agora);
                    tempChart.data.datasets[0].data.push(tempAtual);
                    if (tempChart.data.labels.length > 10) {
                        tempChart.data.labels.shift();
                        tempChart.data.datasets[0].data.shift();
                    }
                    tempChart.update();

                    // Alerta visual
                    if (tempAtual >= 28) {
                        overlay.style.backgroundColor = 'rgba(255,0,0,0.8)';
                    } else if (tempAtual >= 24) {
                        overlay.style.backgroundColor = 'rgba(255,165,0,0.8)';
                    } else {
                        overlay.style.backgroundColor = 'rgba(0,0,0,0.7)';
                    }
                })
                .catch(error => {
                    console.error("Erro ao puxar dados:", error);
                    tempSpan.textContent = "--";
                    umidadeSpan.textContent = "--";
                });
        }
    </script>
</body>
</html>
